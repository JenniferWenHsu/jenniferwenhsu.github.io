<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    padding: 100px;
    width: 1000px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h4 {
    font-family: 'Source Sans Pro', sans-serif;
  }

 figure {
    display: inline-block;
    margin: 20px; /* adjust as needed */
}
figure img {
    vertical-align: top;
}
figure figcaption {
    text-align: center;
}
</style>
<title>CS 184 Final Project</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
</head>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<body>

<h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2017</h1>
<h1 align="middle">Final Project Report <br> Mirage and Fata Morgana</h1>
<h2 align="middle">Sudeep Dasari, CS184-adw <br> Jennifer Hsu, CS184-abn</h2>


<br><br>
<h2> Overview</h2>

<p> In project 3, we wrote a ray-tracing algorithm assuming that light travels in a straight line. However, there are cases where a light takes on a curved path. For example, on a hot summer day, the ground holds a higher temperature than the air, resulting a lower index of refraction. (Higher temperature infers less air density. The lower the density, the faster light travels, and according to snells law, it has a smaller index of refraction ) This phenomenon is called Mirage. In the case when the air has a smaller index of refraction, we call it Fata Morgana. </p> 

<table style="width=100%">
        <tr>
        <td align="middle">
        <figure> 
        <img src="images/mirage.jpeg" width="300px" />
        <figcaption align="middle"> Mirage </figcaption>

        <td align="middle">
        <img src="images/fata.jpeg" width="370px" />
        <figcaption align="middle"> Fata Morgana </figcaption>
        </figure> 
      </tr>
</table>

<h2> Outline </h2>

<h3> Section I: Mirage and Fata Morgana</h3>
	<h4> Part 1: Modeling Change of Air Density</h4>
		<p> To account for the change of index of refraction due to the change of air density, we implemented three different methods: Equal Slab Method, Alternative Slab Method, and Euler Ray Tracing Method. </p>
		<table style="width=100%">
		        <tr>
		        <td align="middle">
		        <figure>
		        <img src="images/mirageExplain.png" width="300px" align="middle"/>
		        <figcaption align="middle"> Mirage <br> (The index of refraction is smaller on the bottom than on the top)</figcaption>
		        </figure>
		        </td>
		      </tr>
		</table>

		<h5> Method 1: Equal Slab Method</h5>
		<p>In this method, we model the change of air density using horizontal slabs. Each slab is of equal height and each of the slab represents a different index of refraction. To get the value for a particular position on the image plan, we shoot a ray from that position into the scene. The ray travels in a straight line until it hits the boundary of the slab. We then use Snell's Law to calculate the new direction. This ray tracing continues until the ray either hits the boundary of the scene or a primitive in the scene. </p>
		<table style="width=100%">
		        <tr>
		        <td>
		        <figure> 
		        <img src="images/equalSlab.png" width="300px" />
		        <figcaption align="middle"> Fixed slab height<br></figcaption>
		        </figure>
		      </tr>
		</table>

		<p> The following are images rendered using different number of slabs. As one can see, if we only model the air with a small number of slabs, we create a lot of artifacts, and the image looks far from accurate. It takes 700 slabs to render a relatively accurate image. </p>
		<h5> Mirage </h5> 
		<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/mirage10.png" width="300px" />
		        <figcaption align="middle"> 10 slabs </figcaption>
		        <td align="middle">
		        <img src="images/mirage100.png" width="300px" />
		        <figcaption align="middle"> 100 slabs </figcaption>
		        <td align="middle">
		        <img src="images/mirage700.png" width="300px" />
		        <figcaption align="middle"> 700 slabs </figcaption>
		      </tr>
		</table>
		<h5> Fata Morgana </h5>
		<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/fata10.png" width="300px" />
		        <figcaption align="middle"> 10 slabs </figcaption>
		        <td align="middle">
		        <img src="images/fata100.png" width="300px" />
		        <figcaption align="middle"> 100 slabs </figcaption>
		        <td align="middle">
		        <img src="images/fata700.png" width="300px" />
		        <figcaption align="middle"> 700 slabs </figcaption>
		      </tr>
		</table>
		<h5> Method 2: Alternative Slab Method</h5>
			<p> However, the method mentioned earlier has two main problems, it takes too long to render and it requires a large number of slab to generate an approximately accurate image</p>
			<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/modifiedmethod.png" width="300px" />
		        <figcaption align="middle"> Fix Ray Length</figcaption>
		      </tr>
			</table>
			<p> In this modified slab method, instead of fixing the height of the slab, we fix the ray length, such that the light is traveling the same distance within a slab. For rays with a smaller angle (with respect to the normal), it corresponds to a larger slab. </p>	
			<h5> Mirage </h5>		
			<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/time_50_mirage.png" width="300px" />
		        <figcaption align="middle"> Time Step: 50 <br> (Low Resolution) </figcaption>
		        <td align="middle">
		        <img src="images/time_10_mirage.png" width="300px" />
		        <figcaption align="middle"> Time Step: 10 <br> (Moderate Resolution)</figcaption>
		        <td align="middle">
		        <img src="images/time_1_mirage.png" width="300px" />
		        <figcaption align="middle"> Time Step: 1 <br> (High Resolution)</figcaption>
		      </tr>
			</table> 
			<h5> Fata Morgana </h5>		
			<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/time_50_fata.png" width="300px" />
		        <figcaption align="middle"> Time Step: 50 <br> (Low Resolution) </figcaption>
		        <td align="middle">
		        <img src="images/time_10_fata.png" width="300px" />
		        <figcaption align="middle"> Time Step: 10 <br> (Moderate Resolution)</figcaption>
		        <td align="middle">
		        <img src="images/time_1_fata.png" width="300px" />
		        <figcaption align="middle"> Time Step: 1 <br> (High Resolution)</figcaption>
		      </tr>
			</table> 
		<h5> Method 3: Euler Ray Tracing</h5>
		<p> In the previous two slab methods, we assume that index of refraction stays constant in points with the same height, however, more complex scenes will require us to relax that assumption. We solve the general case using general equation based on Fermat's principles.</p>

		$$\frac{d}{dl}(n\frac{d \vec{r}}{dl}) - \nabla n = 0 \leftrightarrow 
		\frac{d}{dl}(n\frac{dx_j}{dl}) - \frac{\partial n}{\partial x_j} = 0 \quad \quad \text{    Source: F.J. Seron et. al. }
		$$

		<p> To solve discretize equation and Euler's method to estimate path. </p>

		$$\frac{dx_{ji+i}}{dl} = \frac{n_i(dx_{ji}/dl) + (\partial n / \partial x_j) \delta l_i}{n_{i+1}}  \quad \quad \text{Source: F. J. Seron et. al. }
		$$

	<h4> Part 2: Modeling Heat Source</h4>
	<p> In a more complicated scene, the heat source might be more than just the entire floor. Using the previous example, only the red shaded area of the scene has a relatively higher temperature than the rest. 
			<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/heatsource.png" width="300px"/>
		        <figcaption align="middle"> The red shade area is the heat source. </figcaption>
		      </tr>
			</table> 
			<br> 
			Here is a demonstration that we can set any box in the scene to have a different index of refraction from the surrouding area. </p>
			<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/block_in_middle.png" width="300px" />
		        <figcaption align="middle"> The block has a 0.99 index of refraction, <br> while the rest of the area has 1 as index of refraction. </figcaption>
		      </tr>
			</table> 

<h3> Section II: Application - Gradient-Index Optics (GRIN) </h3>

	<p> Modern camera lenses are made of different glass componenets. Each of the componenets has different index of refraction. These lenses combine together to work as an approximation ideal thin lens. Such combination deviates from the ideal thin lense models, so called aberrations. Aberrations cause visible artifacts in final images. </p>

	<p>Instead, we can use lenses whose index of refraction changes throughout the material. This way, we can create flat lenses and/or lenses without abberations. In thoery, the human eye also has varying index of refraction. </p>

	<p> </p>
			<table style="width=100%">
			   <tr>
		        <td align="middle">
		        <img src="images/bunny.png" width="300px" />
		        <figcaption align="middle"> 512 pixel rays <br> 32 light rays <br> 10 bounces </figcaption>
		       </tr>
		       <tr>
		        <td align="middle">
		        <img src="images/dragon128.png" width="300px" />
		        <figcaption align="middle"> 128 pixel rays <br> 32 light rays <br> 10 bounces </figcaption>
		        <td align="middle">
		        <img src="images/dragon512.png" width="300px" />
		        <figcaption align="middle"> 512 pixel rays <br> 32 light rays <br> 10 bounces</figcaption>
		      </tr>
			</table> 

<p> Milestone resources</p>
<a href="https://www.youtube.com/watch?v=JY5fzc5d4aE">Milestone Video</a>
<br> 
<a href="https://docs.google.com/a/berkeley.edu/presentation/d/1DZWjTugHMejenjGKO1fG3UBtJUfPZmdph4qSLC1bUk0/edit?usp=sharing"> Presentation Slides </a>
</body>
</html>